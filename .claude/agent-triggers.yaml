# Configuration des Déclencheurs d'Agents - Qualiopii
# Système intelligent d'auto-activation des agents spécialisés

version: "1.0"
project_context: "qualiopii"
tdd_mode: true  # TDD obligatoire pour ce projet

# =============================================================================
# DÉCLENCHEURS PRIMAIRES - Auto-activation basée sur le contexte
# =============================================================================

primary_triggers:
  
  # Agent de Conformité Légale - CRITIQUE pour Qualiopi
  legal-compliance-checker:
    priority: 100  # Priorité maximale
    auto_activate_on:
      keywords: 
        - "qualiopi"
        - "rgpd" 
        - "gdpr"
        - "conformité"
        - "compliance"
        - "audit"
        - "indicateur"
        - "réglementation"
        - "donnée personnelle"
        - "consentement"
        - "privacy"
        - "terms"
        - "cgu"
        - "politique"
      file_patterns:
        - "**/privacy/**"
        - "**/legal/**" 
        - "**/compliance/**"
        - "**/*privacy*"
        - "**/*legal*"
        - "**/*audit*"
        - "**/*qualiopi*"
      contexts:
        - "formation_data_handling"
        - "learner_privacy"
        - "audit_preparation"
        - "certification_process"
    confidence_threshold: 0.9
    
  # Test Writer - OBLIGATOIRE après tout changement de code
  test-writer-fixer:
    priority: 95  # Très haute priorité pour TDD
    auto_activate_on:
      keywords:
        - "implement"
        - "feature"
        - "fix"
        - "bug"
        - "refactor"
        - "update"
        - "change"
        - "add"
        - "create"
      file_changes:
        - "**/*.ts"
        - "**/*.js" 
        - "**/*.vue"
        - "**/*.py"
        - "**/controllers/**"
        - "**/models/**"
        - "**/services/**"
      contexts:
        - "after_code_change"
        - "new_feature_implementation" 
        - "bug_fix"
        - "refactoring"
      conditions:
        - "code_modified_without_tests"
        - "test_coverage_below_threshold"
    confidence_threshold: 0.85

  # Backend Architect - Architecture AdonisJS + Multi-tenant
  backend-architect:
    priority: 90
    auto_activate_on:
      keywords:
        - "api"
        - "database"
        - "server"
        - "backend"
        - "model"
        - "controller"
        - "service"
        - "authentication"
        - "authorization"
        - "multi-tenant"
        - "tenant"
        - "organization"
        - "migration"
        - "seed"
      file_patterns:
        - "backend/**/*"
        - "**/controllers/**"
        - "**/models/**" 
        - "**/services/**"
        - "**/database/**"
        - "**/migrations/**"
        - "**/*.sql"
      contexts:
        - "api_design"
        - "database_modeling"
        - "multi_tenant_architecture"
        - "performance_optimization"
    confidence_threshold: 0.85

  # Frontend Developer - Nuxt 3 + shadcn-vue
  frontend-developer:
    priority: 85
    auto_activate_on:
      keywords:
        - "component"
        - "ui"
        - "interface"
        - "frontend"
        - "vue"
        - "nuxt"
        - "composable"
        - "store"
        - "pinia"
        - "tailwind"
        - "responsive"
        - "dashboard"
        - "form"
        - "page"
      file_patterns:
        - "frontend/**/*"
        - "**/components/**"
        - "**/pages/**"
        - "**/composables/**"
        - "**/stores/**"
        - "**/*.vue"
        - "**/plugins/**"
      contexts:
        - "ui_component_creation"
        - "user_interface_update"
        - "responsive_design"
        - "state_management"
    confidence_threshold: 0.8

# =============================================================================
# DÉCLENCHEURS SECONDAIRES - Activation contextuelle avancée
# =============================================================================

secondary_triggers:

  # Whimsy Injector - Auto après UI/UX
  whimsy-injector:
    priority: 70
    auto_activate_after:
      - "frontend-developer"
      - "ui-designer"
    conditions:
      - "ui_component_completed"
      - "user_flow_implemented"
      - "error_state_created"
      - "loading_state_added"
    keywords:
      - "onboarding"
      - "error"
      - "loading"
      - "empty state"
      - "success"
      - "completion"
    confidence_threshold: 0.75

  # API Tester - Tests d'APIs critiques
  api-tester:
    priority: 80
    auto_activate_on:
      keywords:
        - "api test"
        - "performance"
        - "load test"
        - "endpoint"
        - "response time"
        - "scalability"
      contexts:
        - "api_deployment"
        - "performance_concern"
        - "load_testing_needed"
      file_patterns:
        - "**/routes/**"
        - "**/controllers/**"
      conditions:
        - "api_changes_made"
        - "performance_degradation_suspected"
    confidence_threshold: 0.8

  # Sprint Prioritizer - Gestion des sprints 6 jours
  sprint-prioritizer:
    priority: 75
    auto_activate_on:
      keywords:
        - "sprint"
        - "priorité"
        - "priority"
        - "roadmap"
        - "planning"
        - "feature request"
        - "backlog"
        - "deadline"
        - "mvp"
      contexts:
        - "sprint_planning"
        - "priority_conflict"
        - "scope_change"
        - "feature_prioritization"
    confidence_threshold: 0.75

# =============================================================================
# DÉCLENCHEURS SPÉCIALISÉS QUALIOPII
# =============================================================================

qualiopii_specific:

  # Gestion des données de formation
  formation_data_context:
    triggers:
      - "legal-compliance-checker"  # RGPD obligatoire
      - "backend-architect"         # Multi-tenant
      - "test-writer-fixer"         # TDD strict
    keywords:
      - "formation"
      - "apprenant" 
      - "learner"
      - "session"
      - "training"
      - "formateur"
      - "instructor"
      - "attendance"
      - "presence"
      - "evaluation"

  # Indicateurs Qualiopi (32 indicateurs)
  qualiopi_indicators:
    triggers:
      - "legal-compliance-checker"  # Priorité absolue
      - "backend-architect"         # Architecture conforme
      - "test-writer-fixer"         # Tests obligatoires
    keywords:
      - "indicator"
      - "indicateur"
      - "evidence"
      - "preuve"
      - "audit trail"
      - "traceability"
      - "versioning"

  # Interface administrative multi-tenant
  admin_interface:
    triggers:
      - "frontend-developer"
      - "ui-designer"
      - "whimsy-injector"
    keywords:
      - "organization"
      - "tenant"
      - "dashboard"
      - "admin"
      - "management"

# =============================================================================
# CONFIGURATION DES PRIORITÉS ET CONDITIONS
# =============================================================================

activation_rules:
  
  # Règles de priorité
  priority_rules:
    - if: "tdd_mode == true"
      then: "boost_test_writer_priority_by: 20"
    
    - if: "contains(keywords, 'qualiopi')"
      then: "boost_legal_compliance_priority_by: 30"
    
    - if: "file_changes_in: backend/**"
      then: "auto_activate: [backend-architect, test-writer-fixer]"
    
    - if: "file_changes_in: frontend/**"
      then: "auto_activate: [frontend-developer, test-writer-fixer]"

  # Conditions de blocage
  blocking_conditions:
    - condition: "no_tests_for_compliance_feature"
      action: "halt_until_tests_written"
      message: "⛔ TDD OBLIGATOIRE: Tests requis avant implémentation Qualiopi"
    
    - condition: "rgpd_concern_without_legal_review"
      action: "force_legal_compliance_agent"
      message: "⚠️ RGPD: Révision légale obligatoire"

  # Enchaînements d'agents
  agent_chains:
    
    # Chaîne TDD stricte
    tdd_chain:
      sequence: ["test-writer-fixer", "implementation_agent", "test-writer-fixer"]
      mandatory: true
      condition: "any_code_change"
    
    # Chaîne conformité Qualiopi
    qualiopi_chain:
      sequence: ["legal-compliance-checker", "backend-architect", "test-writer-fixer"]
      mandatory: true
      condition: "qualiopi_feature_development"
    
    # Chaîne UI/UX complète
    ui_chain:
      sequence: ["ui-designer", "frontend-developer", "whimsy-injector", "test-writer-fixer"]
      condition: "ui_feature_request"

# =============================================================================
# MÉTRIQUES ET MONITORING
# =============================================================================

monitoring:
  track_activation_success: true
  log_agent_performance: true
  measure_context_accuracy: true
  
  success_metrics:
    - "code_coverage_maintained"
    - "compliance_issues_caught"
    - "performance_maintained"
    - "user_experience_improved"

# =============================================================================
# CONFIGURATION DE DÉVELOPPEMENT
# =============================================================================

dev_settings:
  debug_mode: false
  log_triggers: true
  simulation_mode: false
  
  # Seuils pour Qualiopii
  thresholds:
    qualiopi_features_coverage: 0.95  # 95% obligatoire
    general_features_coverage: 0.80   # 80% minimum  
    api_response_time: 150            # ms max
    ui_load_time: 500                 # ms max

# =============================================================================
# INTÉGRATION AVEC LE WORKFLOW EXISTANT
# =============================================================================

integration:
  claude_commands:
    - "/analyze": ["backend-architect", "frontend-developer"]
    - "/implement": ["test-writer-fixer", "context_specific_agent"]  
    - "/build": ["frontend-developer", "backend-architect"]
    - "/improve": ["performance-benchmarker", "test-writer-fixer"]
  
  git_hooks:
    pre_commit: ["test-writer-fixer"]
    pre_push: ["legal-compliance-checker", "api-tester"]
  
  ci_cd_integration:
    test_stage: ["test-writer-fixer", "api-tester"]
    compliance_stage: ["legal-compliance-checker"]
    performance_stage: ["performance-benchmarker"]